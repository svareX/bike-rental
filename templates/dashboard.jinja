{% extends '__main.jinja' %}

{% block content %}
    <div class="main">
        <div class="box dashboard">
            <div class="flex space-between">
                <div>
                    <h2>Vítejte</h2>
                    <p>
                        Vítejte v nejspolehlivější půjčovně kol na českém trhu! <br>
                        V naší nabídce naleznete široký výběr kol od nejlepších výrobců. <br>
                        Vyberte si to své a vyrazte na cestu! <br>
                        <i>Jednička na českém trhu již 14 let.</i>
                    </p>
                </div>
                <div>
                    <form method="GET" action="{{ url_for('view_dashboard_page') }}"
                          onsubmit="return cleanEmptyParams(this)" class="filter">
                                                
                        <div class="custom-select">
                            <input type="text"
                                name="search"
                                id="search"
                                placeholder="Název kola"
                                value="{{ search_query or '' }}"/>
                        </div>
                        
                        <div class="custom-select">
                            <select name="brand_id" id="brand">
                                <option value="" {% if not selected_brand %}selected{% endif %}>Všechny značky</option>
                                {% for brand in brands %}
                                    <option value="{{ brand.id }}"
                                            {% if selected_brand == brand.id|string %}selected{% endif %} class="custom-option">
                                        {{ brand.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="custom-select">
                            <div class="hidden-toggles">
                                <input type="radio" id="rented" name="rent_status" value="rented" {% if select_rent_status == "rented" %}checked{% endif %}class="hidden-toggles__input">
                                <label for="rented" class="hidden-toggles__label">Pronajatá</label>

                                <input type="radio" id="all" name="rent_status" value="all" {% if select_rent_status == "all" or select_rent_status == null %}checked{% endif %} class="hidden-toggles__input">
                                <label for="all" class="hidden-toggles__label">Všechna</label>

                                <input type="radio" id="free" name="rent_status" value="free" {% if select_rent_status == "free" %}checked{% endif %} class="hidden-toggles__input">
                                <label for="free" class="hidden-toggles__label">Dostupná</label>                            
                            </div>
                        </div>
                        
                        <button type="submit" class="custom-submit">Hledat</button>
                        {% if selected_brand or search_query %}
                            <a href="{{ url_for('view_dashboard_page') }}">
                                <button type="button">Resetovat filtry</button>
                            </a>
                        {% endif %}
                    </form>
                </div>
            </div>

            <div>
                <hr>
                {% if session['role'] == 1 %}
                <a href={{ url_for("add_bike.page") }}>Přidat kolo</a>
                {% endif %}
            </div>

            <div class="grid">
                {% if bikes %}
                    {% for bike in bikes %}
                        <div class="bike" onclick="window.location.href='{{ url_for('rent_bike.page', user_id=session['user_id']|e, bike_id=bike.id|e) }}'">

                            <p class="bike-header">
                                <span>
                                    {{ bike.brand_name }}
                                </span>
                                <span>
                                    <b>{{ bike.name }}</b>
                                </span>
                            </p>
                            <img src="{{ url_for('static', filename='img/' + bike.img) }}" alt="{{ bike.name }}" class="bike-img">
                            <p class="bike-price">Cena na den: <span>{{ bike.price_per_day }}</span></p>
                            {% if session['role'] == 1 %}
                                <a href="{{ url_for('edit_bike.page', bike_id=bike.id) }}">
                                    <button>Upravit</button>
                                </a>
                                <a href="{{ url_for('delete_bike.page', bike_id=bike.id) }}">
                                    <button>Smazat</button>
                                </a>
                            {% elif session['role'] == 0 %}
                                {% if is_rented(bike.id) == 0 or is_rented(bike.id) == 3 %}
                                    <a href="{{ url_for('rent_bike.page', user_id=session['user_id'], bike_id=bike.id) }}">
                                        <button>Vypůjčit si</button>
                                    </a>
                                {% elif is_rented(bike.id) == 1 %}
                                    <b>Kolo je již zapůjčeno do: {{ getRentDate(bike.id).date_to }}</b>
                                {% else %}
                                    <b>Kolo se vyřizuje zaměstnanci.</b>
                                {% endif %}
                            {% endif %}
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        function cleanEmptyParams(form) {
            const searchInput = form.querySelector('input[name="search"]');
            if (searchInput && searchInput.value.trim() === '') {
                searchInput.disabled = true;
            }
            return true;
        }
    </script>
{% endblock %}